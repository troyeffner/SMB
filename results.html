<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Needs Summary — SMB Business Needs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background-color: #f7fafc;
        }
        .site-nav {
            background-color: #1a365d;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }
        .site-nav-back {
            color: #a0c4e8;
            text-decoration: none;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }
        .site-nav-back:hover { color: white; }
        .site-nav-back svg { width: 14px; height: 14px; }
        .site-nav-steps {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nav-step {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #4a7fa8;
            text-decoration: none;
            transition: color 0.2s;
        }
        .nav-step:hover { color: white; }
        .nav-step.active { color: white; cursor: default; }
        .nav-step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4a7fa8;
        }
        .nav-step.active .nav-step-dot { background-color: #1a365d; border: 2px solid #a0c4e8; }
        .nav-arrow { color: #4a7fa8; font-size: 14px; }

        /* ── Hero ── */
        .hero {
            background-color: #1a365d;
            color: white;
            padding: 40px 20px 36px;
            text-align: center;
            border-top: 1px solid #2a4a7a;
        }
        .step-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255,255,255,0.12);
            color: #a0c4e8;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            padding: 4px 12px;
            border-radius: 20px;
            margin-bottom: 14px;
        }
        .hero h1 {
            font-size: 26px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
            letter-spacing: -0.3px;
        }
        .hero-date {
            font-size: 14px;
            color: #a0c4e8;
        }
        @media (min-width: 768px) {
            .hero h1 { font-size: 32px; }
        }

        /* ── Content ── */
        .content {
            max-width: 780px;
            margin: 0 auto;
            padding: 40px 20px 32px;
        }

        /* ── No-data banner ── */
        .no-data-banner {
            background-color: #fffbea;
            border: 1px solid #f6e05e;
            border-left: 4px solid #d69e2e;
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 28px;
            font-size: 14px;
            color: #744210;
        }
        .no-data-banner a { color: #028090; font-weight: 600; text-decoration: none; }
        .no-data-banner a:hover { text-decoration: underline; }

        /* ── Results sections ── */
        .results-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            margin-bottom: 28px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        .section-teal  { border-left: 4px solid #028090; }
        .section-red   { border-left: 4px solid #e53e3e; }
        .section-blue  { border-left: 4px solid #2b6cb0; }
        .section-navy  { border-left: 4px solid #1a365d; }
        .section-number.navy { background-color: #e8edf5; color: #1a365d; }

        /* ── Section 4: Recommendations (accordion) ── */
        .rec-challenge {
            border-bottom: 1px solid #f0f4f8;
        }
        .rec-challenge:last-child { border-bottom: none; }
        .rec-challenge-toggle {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: none;
            border: none;
            padding: 14px 0;
            cursor: pointer;
            text-align: left;
            border-bottom: 1px solid transparent;
        }
        .rec-challenge-toggle[aria-expanded="true"] {
            border-bottom: 1px solid #e2e8f0;
        }
        .rec-challenge-name {
            font-size: 14px;
            font-weight: 700;
            color: #1a365d;
        }
        .rec-chevron {
            width: 16px;
            height: 16px;
            color: #718096;
            flex-shrink: 0;
            transition: transform 0.2s;
        }
        .rec-challenge-toggle[aria-expanded="true"] .rec-chevron {
            transform: rotate(180deg);
        }
        .rec-challenge-body {
            padding: 12px 0 4px;
        }
        .rec-approaches {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        .rec-approach {
            background: #f7fafc;
            border-radius: 6px;
            padding: 10px 14px;
            border-left: 3px solid #1a365d;
        }
        .rec-approach-name {
            font-size: 13px;
            font-weight: 700;
            color: #1a365d;
            margin-bottom: 3px;
        }
        .rec-approach-desc {
            font-size: 12px;
            color: #4a5568;
            line-height: 1.5;
        }
        .rec-firststeps-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #4a5568;
            margin-bottom: 6px;
        }
        .rec-firststeps {
            list-style: none;
            padding-left: 0;
            margin: 0;
        }
        .rec-firststeps li {
            font-size: 12px;
            color: #4a5568;
            padding-left: 14px;
            position: relative;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        .rec-firststeps li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: #1a365d;
            font-size: 11px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px 24px 16px;
            border-bottom: 1px solid #f0f4f8;
        }
        .section-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-weight: 700;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .section-number.teal { background-color: #e6f7f9; color: #028090; }
        .section-number.red  { background-color: #fff5f5; color: #e53e3e; }
        .section-number.blue { background-color: #ebf4ff; color: #2b6cb0; }
        .section-header-text { flex: 1; }
        .section-label-text {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #718096;
            margin-bottom: 2px;
        }
        .section-title {
            font-size: 17px;
            font-weight: 700;
            color: #1a365d;
        }
        .section-body { padding: 20px 24px 24px; }

        /* ── Empty state ── */
        .empty-state {
            color: #a0aec0;
            font-size: 14px;
            font-style: italic;
        }
        .empty-state a { color: #028090; font-style: normal; font-weight: 600; text-decoration: none; }

        /* ── Section 1: Challenge list ── */
        .challenge-list { list-style: none; }
        .challenge-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f4f8;
        }
        .challenge-item:last-child { border-bottom: none; }
        .challenge-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #028090;
            flex-shrink: 0;
            margin-top: 6px;
        }
        .challenge-name { font-size: 14px; font-weight: 600; color: #2d3748; }
        .challenge-desc { font-size: 13px; color: #718096; line-height: 1.5; margin-top: 3px; }

        /* ── Section 2: Mini matrix ── */
        .mini-matrix-wrap { margin-bottom: 24px; }
        .mini-matrix-outer {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        .mini-matrix-axes-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 10px;
        }
        .mini-matrix-y-label {
            font-size: 11px;
            font-weight: 700;
            color: #4a5568;
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            white-space: nowrap;
            flex-shrink: 0;
        }
        .mini-matrix-inner { flex: 1; }
        .mini-matrix {
            width: 100%;
            max-width: 480px;
            height: 260px;
            position: relative;
            border: 2px solid #2d3748;
            background:
                linear-gradient(to right, #fef5e7 0%, #fef5e7 50%, #ffebee 50%, #ffebee 100%),
                linear-gradient(to top,   #e8f5e9 0%, #e8f5e9 50%, #fff9c4 50%, #fff9c4 100%);
            background-blend-mode: multiply;
        }
        .mini-matrix-vline {
            position: absolute; left: 50%; top: 0; bottom: 0;
            width: 1px; background-color: rgba(45,55,72,0.4);
        }
        .mini-matrix-hline {
            position: absolute; top: 50%; left: 0; right: 0;
            height: 1px; background-color: rgba(45,55,72,0.4);
        }
        .mini-matrix-qlabel {
            position: absolute;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #4a5568;
            opacity: 0.55;
        }
        .mini-matrix-qlabel.q1 { top: 6px; right: 6px; text-align: right; }
        .mini-matrix-qlabel.q2 { top: 6px; left: 6px; }
        .mini-matrix-qlabel.q3 { bottom: 6px; left: 6px; }
        .mini-matrix-qlabel.q4 { bottom: 6px; right: 6px; text-align: right; }
        .mini-dot {
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background-color: #e53e3e;
            color: white;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            box-shadow: 0 1px 4px rgba(0,0,0,0.25);
            cursor: default;
        }
        .mini-matrix-x-label {
            font-size: 11px;
            font-weight: 700;
            color: #4a5568;
            text-align: center;
            margin-top: 6px;
        }
        .mini-matrix-legend {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .mini-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #4a5568;
        }
        .mini-legend-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #e53e3e;
            color: white;
            font-size: 9px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ── Section 2: Quadrant groups ── */
        .quadrant-groups { margin-top: 20px; }
        .quadrant-group { margin-bottom: 18px; }
        .quadrant-group:last-child { margin-bottom: 0; }
        .quadrant-group-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding-bottom: 6px;
            margin-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        .quadrant-group.q-urgent .quadrant-group-title { color: #c53030; }
        .quadrant-group.q-watch .quadrant-group-title  { color: #d69e2e; }
        .quadrant-group.q-quick .quadrant-group-title  { color: #2b6cb0; }
        .quadrant-group.q-defer .quadrant-group-title  { color: #718096; }
        .placement-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 0;
        }
        .placement-dot {
            width: 8px; height: 8px; border-radius: 50%;
            flex-shrink: 0;
        }
        .q-urgent .placement-dot { background-color: #c53030; }
        .q-watch  .placement-dot { background-color: #d69e2e; }
        .q-quick  .placement-dot { background-color: #2b6cb0; }
        .q-defer  .placement-dot { background-color: #a0aec0; }
        .placement-name { font-size: 14px; font-weight: 600; color: #2d3748; }

        /* ── Section 3: Intersections ── */
        .intersection-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f4f8;
        }
        .intersection-item:last-child { border-bottom: none; }
        .lightning-icon { font-size: 16px; flex-shrink: 0; margin-top: 2px; }
        .intersection-text { font-size: 14px; font-weight: 600; color: #2d3748; }
        .intersection-sub { font-size: 12px; color: #718096; margin-top: 1px; }

        /* ── PDF bar ── */
        .pdf-bar {
            max-width: 780px;
            margin: 0 auto;
            padding: 0 20px 48px;
        }
        .pdf-main-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            background-color: #1a365d;
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 4px 12px rgba(26,54,93,0.3);
        }
        .pdf-main-btn:hover { background-color: #2a4a7a; }
        .pdf-main-btn svg { width: 20px; height: 20px; }

        .footer {
            text-align: center;
            padding: 32px 20px;
            color: #a0aec0;
            font-size: 13px;
            border-top: 1px solid #e2e8f0;
        }

        /* ── Print styles ── */
        @page {
            size: letter portrait;
            margin: 0.75in;
        }
        @media print {
            body { background-color: white; margin: 0; padding: 0; }
            .site-nav, .pdf-bar, .footer, .no-data-banner {
                display: none !important;
                height: 0 !important;
                overflow: hidden !important;
            }

            .hero {
                padding: 20px 0 16px;
                background-color: #1a365d !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                page-break-before: avoid;
                break-before: avoid;
                margin-top: 0;
            }
            .hero h1 { font-size: 22px; }

            .content { padding: 20px 0 0; max-width: 100%; }

            .results-section {
                box-shadow: none;
                border-radius: 0;
                margin-bottom: 18px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .section-header {
                page-break-after: avoid;
                break-after: avoid;
            }

            .mini-matrix {
                max-width: 360px;
                height: 200px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
    <script src="challenges-content.js"></script>
</head>
<body>

    <nav class="site-nav">
        <a href="index.html" class="site-nav-back">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
            SMB Business Needs
        </a>
        <div class="site-nav-steps">
            <a href="businessopps.html" class="nav-step">
                <div class="nav-step-dot"></div>
                Discover
            </a>
            <span class="nav-arrow">&rarr;</span>
            <a href="prioritization.html" class="nav-step">
                <div class="nav-step-dot"></div>
                Prioritize
            </a>
            <span class="nav-arrow">&rarr;</span>
            <a href="intersection.html" class="nav-step">
                <div class="nav-step-dot"></div>
                Map
            </a>
            <span class="nav-arrow">&rarr;</span>
            <div class="nav-step active">
                <div class="nav-step-dot"></div>
                Results
            </div>
        </div>
    </nav>

    <div class="hero">
        <div class="step-badge">✦ Summary</div>
        <h1>Your Business Needs Summary</h1>
        <div class="hero-date" id="summaryDate"></div>
    </div>

    <div class="content">

        <div class="no-data-banner" id="noDataBanner" style="display:none;">
            No session data found. <a href="businessopps.html">Start from Step 1</a> to generate your personalized summary.
        </div>

        <!-- Section 1: Challenges Identified -->
        <div class="results-section section-teal">
            <div class="section-header">
                <div class="section-number teal">1</div>
                <div class="section-header-text">
                    <div class="section-label-text">Step 1 — Discover</div>
                    <div class="section-title">Challenges Identified</div>
                </div>
            </div>
            <div class="section-body">
                <div id="challengesList"></div>
            </div>
        </div>

        <!-- Section 2: Priority Matrix -->
        <div class="results-section section-red">
            <div class="section-header">
                <div class="section-number red">2</div>
                <div class="section-header-text">
                    <div class="section-label-text">Step 2 — Prioritize</div>
                    <div class="section-title">Priority Matrix Placements</div>
                </div>
            </div>
            <div class="section-body">
                <div id="matrixSummary"></div>
            </div>
        </div>

        <!-- Section 3: Key Intersections -->
        <div class="results-section section-blue">
            <div class="section-header">
                <div class="section-number blue">3</div>
                <div class="section-header-text">
                    <div class="section-label-text">Step 3 — Map</div>
                    <div class="section-title">Key Intersections</div>
                </div>
            </div>
            <div class="section-body">
                <div id="intersectionsList"></div>
            </div>
        </div>

        <!-- Section 4: Service Design Starting Points -->
        <div class="results-section section-navy">
            <div class="section-header">
                <div class="section-number navy">4</div>
                <div class="section-header-text">
                    <div class="section-label-text">Next Steps</div>
                    <div class="section-title">Starting Points</div>
                </div>
            </div>
            <div class="section-body">
                <div id="recommendationsList"></div>
            </div>
        </div>

    </div>

    <!-- Prominent PDF button -->
    <div class="pdf-bar">
        <button class="pdf-main-btn" onclick="saveAsPDF()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg>
            Save Full Summary as PDF
        </button>
    </div>

    <div class="footer">SMB Business Needs Toolkit</div>

    <script>
        // ── Reference data ──
        const ALL_CATEGORIES = [
            { id: 1,  label: "Alignment & Getting on the Same Page" },
            { id: 2,  label: "Process Breakdowns & Bottlenecks" },
            { id: 3,  label: "Handoffs & Communication Gaps" },
            { id: 4,  label: "People Working Around the System" },
            { id: 5,  label: "Scaling & Growth Pains" },
            { id: 6,  label: "Technology & System Integration" },
            { id: 7,  label: "Priorities & Decision-Making" },
            { id: 8,  label: "Customer or Quality Issues" },
            { id: 9,  label: "New Hire Onboarding" },
            { id: 10, label: "Unclear Roles & Responsibilities" }
        ];
        const ID_TO_LABEL = {};
        ALL_CATEGORIES.forEach(c => { ID_TO_LABEL[c.id] = c.label; });

        const AXIS_CONFIGS = {
            'risk-pain': {
                yLabel: 'Business Risk (Impact)',
                xLabel: 'Current Pain Level',
                quadrants: {
                    topRight:    'High Risk / High Pain',
                    topLeft:     'High Risk / Low Pain',
                    bottomRight: 'Low Risk / High Pain',
                    bottomLeft:  'Low Risk / Low Pain'
                },
                urgency: {
                    topRight:    'act-now',
                    topLeft:     'watch',
                    bottomRight: 'quick-wins',
                    bottomLeft:  'defer'
                }
            },
            'importance-satisfaction': {
                yLabel: 'Importance to Business',
                xLabel: 'Satisfaction with Current Solution',
                quadrants: {
                    topRight:    'High Importance / High Satisfaction',
                    topLeft:     'High Importance / Low Satisfaction',
                    bottomRight: 'Low Importance / High Satisfaction',
                    bottomLeft:  'Low Importance / Low Satisfaction'
                },
                urgency: {
                    topLeft:     'act-now',
                    topRight:    'watch',
                    bottomLeft:  'defer',
                    bottomRight: 'quick-wins'
                }
            }
        };

        function readStorage(key) {
            try { const r = localStorage.getItem(key); return r ? JSON.parse(r) : null; }
            catch(e) { return null; }
        }

        const smb_selected      = readStorage('smb_selected');
        const rawPlacements     = readStorage('smb_placements');
        const axisId            = rawPlacements?.axisId || 'risk-pain';
        const smb_placements    = rawPlacements?.items || rawPlacements;
        const axisCfg           = AXIS_CONFIGS[axisId] || AXIS_CONFIGS['risk-pain'];
        const smb_intersections = readStorage('smb_intersections');

        // ── Date ──
        document.getElementById('summaryDate').textContent = new Date().toLocaleDateString('en-US', {
            year: 'numeric', month: 'long', day: 'numeric'
        });

        // ── No-data banner ──
        if (!smb_selected && !smb_placements && !smb_intersections) {
            document.getElementById('noDataBanner').style.display = 'block';
        }

        // ── Section 1: Challenges ──
        (function() {
            const el = document.getElementById('challengesList');
            if (!smb_selected || smb_selected.length === 0) {
                el.innerHTML = '<div class="empty-state">No challenges selected yet. <a href="businessopps.html">Complete Step 1</a> to see results here.</div>';
                return;
            }
            const ID_TO_SLUG = {
                1: 'alignment', 2: 'process', 3: 'handoffs', 4: 'workarounds',
                5: 'scaling', 6: 'technology', 7: 'priorities', 8: 'quality',
                9: 'onboarding', 10: 'roles'
            };
            const items = smb_selected.map(id => ALL_CATEGORIES.find(c => c.id === id)).filter(Boolean);
            el.innerHTML = '<ul class="challenge-list">' + items.map(cat => {
                const slug = ID_TO_SLUG[cat.id];
                const desc = (typeof challengesContent !== 'undefined') && challengesContent.discover && challengesContent.discover[slug]?.whatThisMeans;
                return `
                <li class="challenge-item">
                    <div class="challenge-dot"></div>
                    <div>
                        <div class="challenge-name">${cat.label}</div>
                        ${desc ? `<div class="challenge-desc">${desc}</div>` : ''}
                    </div>
                </li>`;
            }).join('') + '</ul>';
        })();

        // ── Section 2: Priority Matrix ──
        (function() {
            const el = document.getElementById('matrixSummary');
            if (!smb_placements || Object.keys(smb_placements).length === 0) {
                el.innerHTML = '<div class="empty-state">No matrix placements yet. <a href="prioritization.html">Complete Step 2</a> to see results here.</div>';
                return;
            }

            const entries = Object.entries(smb_placements);
            const q = axisCfg.quadrants;

            // Mini matrix visual
            let matrixHtml = `
                <div class="mini-matrix-axes-label">Axes: ${axisCfg.yLabel} vs. ${axisCfg.xLabel}</div>
                <div class="mini-matrix-wrap">
                    <div class="mini-matrix-outer">
                        <div class="mini-matrix-y-label">↑ ${axisCfg.yLabel} ↑</div>
                        <div class="mini-matrix-inner">
                            <div class="mini-matrix" id="miniMatrix">
                                <div class="mini-matrix-vline"></div>
                                <div class="mini-matrix-hline"></div>
                                <div class="mini-matrix-qlabel q2">${q.topLeft.replace(' / ', '<br>')}</div>
                                <div class="mini-matrix-qlabel q1">${q.topRight.replace(' / ', '<br>')}</div>
                                <div class="mini-matrix-qlabel q3">${q.bottomLeft.replace(' / ', '<br>')}</div>
                                <div class="mini-matrix-qlabel q4">${q.bottomRight.replace(' / ', '<br>')}</div>
            `;
            const legendItems = [];
            entries.forEach(([id, data], idx) => {
                const num = idx + 1;
                matrixHtml += `<div class="mini-dot" style="left:${data.x_pct}%;top:${data.y_pct}%;" title="${data.label}">${num}</div>`;
                legendItems.push(`<div class="mini-legend-item"><div class="mini-legend-dot">${num}</div><span>${data.label}</span></div>`);
            });
            matrixHtml += `
                            </div>
                            <div class="mini-matrix-x-label">→ ${axisCfg.xLabel} →</div>
                        </div>
                    </div>
                    <div class="mini-matrix-legend">${legendItems.join('')}</div>
                </div>
            `;

            // Quadrant groupings — dynamic from axisCfg
            const quadrantBuckets = {};
            Object.values(q).forEach(name => { quadrantBuckets[name] = []; });
            entries.forEach(([id, data]) => {
                if (quadrantBuckets[data.quadrant] !== undefined) quadrantBuckets[data.quadrant].push(data.label);
            });

            const urgencyConfig = {
                'act-now':    { cls: 'q-urgent', suffix: '— Act now' },
                'watch':      { cls: 'q-watch',  suffix: '— Watch carefully' },
                'quick-wins': { cls: 'q-quick',  suffix: '— Quick wins' },
                'defer':      { cls: 'q-defer',  suffix: '— Defer' }
            };
            const urgencyOrder = ['act-now', 'watch', 'quick-wins', 'defer'];
            const quadrantDefs = urgencyOrder.map(level => {
                const pos = Object.keys(axisCfg.urgency).find(k => axisCfg.urgency[k] === level);
                const key = axisCfg.quadrants[pos];
                const cfg = urgencyConfig[level];
                return { key, cls: cfg.cls, title: `${key} ${cfg.suffix}` };
            });

            let groupsHtml = '<div class="quadrant-groups">';
            quadrantDefs.forEach(qd => {
                const items = quadrantBuckets[qd.key];
                if (!items || !items.length) return;
                groupsHtml += `
                    <div class="quadrant-group ${qd.cls}">
                        <div class="quadrant-group-title">${qd.title}</div>
                        ${items.map(label => `
                            <div class="placement-item">
                                <div class="placement-dot"></div>
                                <div class="placement-name">${label}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            groupsHtml += '</div>';

            el.innerHTML = matrixHtml + groupsHtml;
        })();

        // ── Section 3: Intersections ──
        (function() {
            const el = document.getElementById('intersectionsList');
            if (!smb_intersections || smb_intersections.length === 0) {
                el.innerHTML = '<div class="empty-state">No intersections marked yet. <a href="intersection.html">Complete Step 3</a> to see results here.</div>';
                return;
            }

            const items = smb_intersections.map(cellId => {
                const [rowId, colId] = cellId.split('-').map(Number);
                return {
                    rowLabel: ID_TO_LABEL[rowId] || `Category ${rowId}`,
                    colLabel: ID_TO_LABEL[colId] || `Category ${colId}`
                };
            });

            el.innerHTML = items.map(item => `
                <div class="intersection-item">
                    <div class="lightning-icon">⚡</div>
                    <div>
                        <div class="intersection-text">${item.rowLabel}</div>
                        <div class="intersection-sub">intersects with ${item.colLabel}</div>
                    </div>
                </div>
            `).join('');
        })();

        // ── Section 4 accordion toggle ──
        function toggleRec(btn) {
            const body = btn.nextElementSibling;
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!expanded));
            body.hidden = expanded;
        }

        // ── Section 4: Starting Points ──
        (function() {
            const ID_TO_SLUG = {
                1: 'alignment', 2: 'process', 3: 'handoffs', 4: 'workarounds',
                5: 'scaling', 6: 'technology', 7: 'priorities', 8: 'quality',
                9: 'onboarding', 10: 'roles'
            };
            const el = document.getElementById('recommendationsList');
            if (!smb_selected || smb_selected.length === 0) {
                el.innerHTML = '<div class="empty-state">No challenges selected yet. <a href="businessopps.html">Complete Step 1</a> to see recommendations here.</div>';
                return;
            }
            const html = smb_selected.map(numId => {
                const slug = ID_TO_SLUG[numId];
                const cat = ALL_CATEGORIES.find(c => c.id === numId);
                const rec = (typeof challengesContent !== 'undefined') && challengesContent.recommendations && challengesContent.recommendations[slug];
                if (!rec) return '';
                const approachesHtml = rec.approaches.map(a => `
                    <div class="rec-approach">
                        <div class="rec-approach-name">${a.name}</div>
                        <div class="rec-approach-desc">${a.description}</div>
                    </div>
                `).join('');
                const stepsHtml = rec.firstSteps.map(s => `<li>${s}</li>`).join('');
                return `
                    <div class="rec-challenge">
                        <button class="rec-challenge-toggle" onclick="toggleRec(this)" aria-expanded="false">
                            <span class="rec-challenge-name">${cat ? cat.label : slug}</span>
                            <svg class="rec-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="rec-challenge-body" hidden>
                            <div class="rec-approaches">${approachesHtml}</div>
                            <div class="rec-firststeps-label">First Steps</div>
                            <ul class="rec-firststeps">${stepsHtml}</ul>
                        </div>
                    </div>
                `;
            }).join('');
            el.innerHTML = html || '<div class="empty-state">No recommendations available.</div>';
            // Open the first item by default
            const firstToggle = el.querySelector('.rec-challenge-toggle');
            if (firstToggle) toggleRec(firstToggle);
        })();

        // ── Save as PDF ──
        function saveAsPDF() {
            const now = new Date();
            const pad = n => String(n).padStart(2, '0');
            const ts = `${now.getFullYear()}_${pad(now.getMonth()+1)}_${pad(now.getDate())}`;
            document.title = `${ts}_SMB_Business_Needs_Summary`;
            window.print();
        }
    </script>

</body>
</html>
